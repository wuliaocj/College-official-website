<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://unpkg.com/@wangeditor/editor@latest/dist/css/style.css" rel="stylesheet"/>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        #editor—wrapper {
            border: 1px solid #ccc;
            z-index: 100; /* 按需定义 */
        }

        #toolbar-container {
            border-bottom: 1px solid #ccc;
        }

        #editor-container {
            height: 500px;
        }
    </style>
    <script src="https://unpkg.com/@wangeditor/editor@latest/dist/index.js"></script>
    <script>

    const {createEditor, createToolbar} = window.wangEditor
        const editorConfig = {
            placeholder: 'Type here...',
            onChange(editor) {
                const html = editor.getHtml()
                // console.log('editor content', html)
                // 也可以同步到 <textarea>
            },
            MENU_CONF: {}
        }
        editorConfig.MENU_CONF['uploadImage'] = {
            server: 'upload',
            maxFileSize: 10 * 1024 * 1024, // 1M
        }
        const toolbarConfig = {}
        let editor = {};
        window.onload = function () {
            editor = createEditor({
                selector: '#editor-container',
                html: '<h2 style="text-align: center;">【访企拓岗促就业】机电工程学院、数学与计算科学学院赴珠三角开展访企拓岗暨校友走访活动（图）</h2><hr/><p> &nbsp; &nbsp; &nbsp; &nbsp;近日，机电工程学院、数学与计算科学学院负责人带队先后前往佛山市顺德区冠宇达电源有限公司、日丰企业集团有限公司、中山市罗顿智能科技有限公司、惠州市博实结科技有限公司等单位开展访企拓岗暨校友走访活动。校企围绕人才培养、专业实习、产学研合作、毕业生推介等方面开展深入交流，并听取校友对校庆工作和学校高质量发展的意见建议。</p><p style=\"text-align: center;\"><img src=\"http://localhost:8080/upload/aaa.png\" style=\"width: 50%;\"/></p>',
                config: editorConfig,
                mode: 'default', // or 'simple'
            })

            const toolbar = createToolbar({
                editor,
                selector: '#toolbar-container',
                config: toolbarConfig,
                mode: 'default', // or 'simple'
            })
        }





    function showNews() {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "getNews", true);
        xhr.setRequestHeader("Content-Type", "application/json");
        xhr.setRequestHeader("Accept", "application/json");

        xhr.onreadystatechange = function () {
            // 只有当请求完成时才处理
            if (xhr.readyState === 4) {
                console.log("响应状态码：", xhr.type);
                console.log("原始响应内容：", xhr.responseText); // 查看服务器返回的原始内容

                if (xhr.status === 200) {
                    // 检查响应内容是否为空
                    if (!xhr.responseText.trim()) {
                        console.error("服务器返回空内容");
                        return;
                    }

                    try {
                        // 解析JSON
                        let jsonNews = JSON.parse(xhr.responseText);

                        if (Array.isArray(jsonNews)) {
                            console.log("返回的新闻数量：" + jsonNews.length);
                            // 显示第一条新闻的标题作为示例
                            if (jsonNews.length > 0) {
                                console.log("第一条新闻标题：" + jsonNews[0].title);
                            }
                        } else {
                            console.log("返回的新闻数据：", jsonNews);
                        }
                    } catch (e) {
                        console.error("JSON解析失败：", e);
                        console.error("导致错误的内容：", xhr.responseText);
                    }
                } else {
                    console.error("请求失败，状态码：" + xhr.status);
                }
            }
        };

        xhr.send();
    }

        function saveNews() {
            let content = editor.getHtml();
            // 图片回显后，新闻内容会包含图片的url地址
            console.log("新闻内容：", content)
            // 用Ajax发送post请求即可¬
            let xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4) {
                    if (xhr.status == 200) {

                        console.log("后端返回的数据：", xhr.responseText)
                        let result = JSON.parse(xhr.responseText);
                        if (result.code == 200) {
                            editor.setHtml("");
                        }
                    }
                }
            }
            let provider = document.querySelector("#provider").value;
            // 传递给后端的数据，包含了新闻内容、供稿人
            let data = {
                content,
                provider
            }
            xhr.open("POST", "saveNews");
            xhr.send(JSON.stringify(data))
        }
    </script>
</head>
<body>
<!--<img src="http://39.108.123.201:8080/mysite/DSC_2490.JPG" alt="" width="80%" height="50%">-->
<div id="editor—wrapper">
    <div id="toolbar-container"><!-- 工具栏 --></div>
    <div id="editor-container"><!-- 编辑器 --></div>
</div>
<label for="provider">供稿人：</label>
<select name="provider" id="provider">
    <option value="ly">赖艳</option>
    <option value="ll">凌琳</option>
    <option value="ly">李燕</option>
</select>
<button onclick="saveNews()">发布</button>
<button onclick="showNews()">查看（测试用）</button>
</body>
</html>
